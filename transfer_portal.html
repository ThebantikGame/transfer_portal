<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—Ä—Ç–∞–ª –û–±–º–µ–Ω–∞ –ö–æ–¥–æ–º/–¢–µ–∫—Å—Ç–æ–º</title>
    <!-- Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–µ–π -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç Inter –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6 border-b pb-2">
            üöÄ –ü–æ—Ä—Ç–∞–ª –û–±–º–µ–Ω–∞ (–ü–ö <-> –¢–µ–ª–µ—Ñ–æ–Ω)
        </h1>
        <p id="user-info" class="text-xs text-center text-gray-500 mb-4"></p>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –≤–≤–æ–¥–∞/–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <div class="bg-white p-6 rounded-xl shadow-2xl border border-gray-100">
            <label for="content-input" class="block text-lg font-semibold text-gray-700 mb-3">
                –í–∞—à —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:
            </label>
            <textarea id="content-input" 
                      rows="10" 
                      placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–æ–¥, —Ç–µ–∫—Å—Ç, —Å—Å—ã–ª–∫–∏ –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç..."
                      class="w-full p-4 border-2 border-indigo-200 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 text-gray-900 shadow-inner resize-none">
            </textarea>
            
            <div class="flex flex-col sm:flex-row gap-4 mt-4">
                <button id="save-button" 
                        class="w-full sm:w-1/2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition duration-300 shadow-md disabled:opacity-50"
                        disabled>
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button id="copy-button" 
                        class="w-full sm:w-1/2 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition duration-300 shadow-md">
                    üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¢–µ–∫—É—â–∏–π –ö–æ–Ω—Ç–µ–Ω—Ç
                </button>
            </div>
            
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ -->
        <div id="status-message" class="mt-6 text-center text-sm text-gray-600 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>

        <p class="text-xs text-center text-gray-400 mt-8">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="last-updated">--</span>
        </p>

    </div>

    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Canvas (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let userId = '';

        const inputField = document.getElementById('content-input');
        const saveButton = document.getElementById('save-button');
        const copyButton = document.getElementById('copy-button');
        const statusMessage = document.getElementById('status-message');
        const userInfo = document.getElementById('user-info');
        const lastUpdated = document.getElementById('last-updated');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase –∏ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                     statusMessage.textContent = '–û—à–∏–±–∫–∞: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.';
                     return;
                }
                
                // –í–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                setLogLevel('Debug');
                
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser?.uid || crypto.randomUUID();
                userInfo.textContent = `App ID: ${appId} | User ID: ${userId.substring(0, 8)}...`;
                
                statusMessage.textContent = '–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ. –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—â–∏–π –±—É—Ñ–µ—Ä...';
                saveButton.disabled = false;

                // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                startRealtimeListener();

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase –∏–ª–∏ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:", error);
                statusMessage.textContent = `–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        // –ü—É—Ç—å –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É –¥–ª—è –æ–±–º–µ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏)
        const transferPath = `artifacts/${appId}/public/data/shared_data/transfer_content`;

        // 3. –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ª—É—à–∞—Ç–µ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (onSnapshot)
        function startRealtimeListener() {
            if (!db) return;

            const docRef = doc(db, transferPath);

            onSnapshot(docRef, (docSnapshot) => {
                if (docSnapshot.exists()) {
                    const data = docSnapshot.data();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ —Å—Ç–∞—Ç—É—Å
                    inputField.value = data.content || '';
                    statusMessage.textContent = '–ë—É—Ñ–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ).';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
                    if (data.timestamp) {
                        const date = data.timestamp.toDate ? data.timestamp.toDate() : new Date();
                        lastUpdated.textContent = date.toLocaleTimeString('ru-RU',
